// ../../node_modules/@evidence-dev/sdk/src/lib/sharedPromise.js
var sharedPromise = (stateChangeHook) => {
  let res = null;
  let rej = null;
  const p = new Promise((a, b) => {
    res = a;
    rej = b;
  });
  let state = "init";
  let resolvedValue = null;
  if (!res || !rej)
    throw new Error();
  return {
    promise: p,
    /**
     * @param {ResolveType} v
     */
    resolve: (v) => {
      if (res) {
        if (state === "loading" || state === "init") {
          state = "resolved";
          resolvedValue = v;
          res(v);
          stateChangeHook == null ? void 0 : stateChangeHook();
        }
      } else
        throw new Error("SharedPromise encountered an error: res not defined");
    },
    /**
     *
     * @param {Error} e
     */
    reject: (e) => {
      if (rej) {
        if (state === "loading" || state === "init") {
          state = "rejected";
          p.catch(() => {
          });
          rej(e);
          stateChangeHook == null ? void 0 : stateChangeHook();
        }
      } else
        throw new Error("SharedPromise encountered an error: rej not defined");
    },
    get state() {
      return state;
    },
    get value() {
      return resolvedValue;
    },
    start() {
      state = "loading";
      stateChangeHook == null ? void 0 : stateChangeHook();
    }
  };
};

export {
  sharedPromise
};
//# sourceMappingURL=chunk-SYM22BZ5.js.map
